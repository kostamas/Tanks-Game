walls(Walls):-
    Walls = [0-0, 0-50, 0-100, 0-150, 0-200, 0-250, 0-300, 0-350, 0-400, 0-500, 0-550,      /*left wall*/

             0-550, 50-550, 100-550, 150-550, 200-550, 250-550, 300-550, 350-550, 400-550, 450-550,   /*bottom wall*/
             500-550, 500-550, 550-550, 600-550, 650-550, 700-550, 750-550, 800-550, 850-550,
             900-550, 950-550, 1000-550, 1050-550, 1100-550, 1150-550, 1200-550, 1250-550,

            1250-0, 1250-50, 1250-100, 1250-150, 1250-200, 1250-250,                                   /*right wall*/
            1250-300, 1250-350, 1250-400, 1250-450, 1250-500, 1250-550,

            50-0, 100-0, 150-0, 200-0, 250-0, 300-0, 350-0, 400-0, 450-0,                                /*top wall*/
            500-0, 500-0, 550-0, 600-0, 650-0, 700-0, 750-0, 800-0, 850-0,
            900-0, 950-0, 1000-0, 1050-0, 1100-0, 1150-0, 1200-0, 1250-0

     ].

/* ------------ const values  --------------- */

shooting_area(Distance):-
    Distance is 90.

tank_move_length(Length):-
    Length is 50.

bad_val(BadVal):-
    BadVal is -10000.


alpha_beta_depth(Depth):-        /* define the depth of the alpha beta tree*/
    Depth is 2.

/* ------------ const values  --------------- */


moves([_,_, _, AlphaBetaDepth], _):-
    alpha_beta_depth(Depth),
    AlphaBetaDepth == Depth,!,fail.

moves([CTank1, HTank2, PLAYER, AlphaBetaDepth], PosList):-
    AlphaBetaDepth2 is AlphaBetaDepth + 1,
    next_moves([CTank1, HTank2, PLAYER, AlphaBetaDepth2], PosList).


next_moves([[C1X,C1Y,CL1], [H1X,H1Y,HL1], PLAYER, AlphaBetaDepth], PosList):-
     PLAYER = computer,  X is C1X, Y is C1Y,
     X1 is X - 50, Y1 is Y, add_to_pos_list(X1,Y1,[[X1,Y1,CL1], [H1X,H1Y,HL1], humen, AlphaBetaDepth], [], PosList1),
     X2 is X - 50, Y2 is Y - 50, add_to_pos_list(X2,Y2,[[X2,Y2,CL1], [H1X,H1Y,HL1], humen, AlphaBetaDepth], PosList1, PosList2),
     X3 is X - 50, Y3 is Y + 50, add_to_pos_list(X3,Y3,[[X3,Y3,CL1], [H1X,H1Y,HL1], humen, AlphaBetaDepth], PosList2, PosList).

next_moves([[C1X,C1Y,CL1], [H1X,H1Y,HL1], PLAYER, AlphaBetaDepth], PosList):-
     PLAYER = humen, X is H1X, Y is H1Y,
     X1 is X + 50, Y1 is Y, add_to_pos_list(X1,Y1,[[C1X,C1Y,CL1],[X1,Y1,CL1], computer, AlphaBetaDepth] [], PosList1),
     X2 is X + 50, Y2 is Y - 50, add_to_pos_list([[C2X,C2Y,CL1],[X2,Y2,CL1], computer, AlphaBetaDepth], PosList1, PosList2),
     X3 is X + 50, Y3 is Y + 50, add_to_pos_list([[C3X,C3Y,CL1],[X2,Y2,CL1], computer, AlphaBetaDepth], PosList2, PosList).


add_to_pos_list(X,Y,Pos, PosList, Result):-
    not(collision(X, Y)),
    X > 0, Y < 1200,                                  /*game borders*/
    X> 0 , Y < 600,                                   /*game borders*/
    append([Pos],PosList,Result).

add_to_pos_list(X,Y,Pos, PosList, PosList).

collision(X,Y):-
        walls(Walls),
        collision(X,Y,Walls).

collision(X,Y,[]):- fail.

collision(X,Y,[X1-Y1|Walls]):-
    X + 30 >= X1, X < X1 + 50,
    Y + 30 >= Y1, Y < Y1 + 50
    ;
    collision(X,Y,Walls).



/* ------------------ alpha beta algorithm ------------------*/

alphabeta(Pos, Alpha, Beta, GoodPos, Val):-
    moves(Pos, PosList),!,
    boundedbest(PosList, Alpha, Beta, GoodPos, Val); 
    staticval(Pos, Val).

boundedbest([Pos|PosList], Alpha, Beta, GoodPos, GoodVal):-
    alphabeta(Pos, Alpha, Beta,_,Val),
    goodenough(PosList, Alpha, Beta, Pos, Val, GoodPos, GoodVal).

goodenough([],_,_,Pos, Val, Pos, Val):- !.

goodenough(_,Alpha, Beta, Pos, Val, Pos, Val):-
    min_to_move(Pos), Val > Beta, !;
    max_to_move(Pos), Val < Alpha, !.


goodenough(PosList, Alpha, Beta, Pos, Val, GoodPos, GoodVal):-
    newbounds(Alpha, Beta, Pos, Val, NewAlpha, NewBeta),
    boundedbest(PosList, NewAlpha, NewBeta, Pos1, Val1),
    betterof(Pos, Val, Pos1, Val1, GoodPos, GoodVal).


newbounds(Alpha, Beta, Pos, Val, Val, Beta):-
    min_to_move(Pos), Val > Alpha, !.


newbounds(Alpha, Beta, Pos, Val, Alpha, Val):-
    max_to_move(Pos), Val < Beta, !.

newbounds(Alpha, Beta,_,_, Alpha, Beta).

betterof(Pos, Val, Pos1, Val1, Pos, Val):-
    min_to_move(Pos), Val > Val1, !;
    max_to_move(Pos), Val < Val1, !.

betterof(_,_,Pos1,Val1,Pos1,Val1).


min_to_move([_,_,PLAYER,_]):-
    PLAYER = humen.
 max_to_move([_,_,PLAYER,_]):-
    PLAYER = computer.

/* ------------------ alpha beta algorithm ------------------*/





/*-------------------  evaluation function  --------------------*/

staticval([[C1X,C1Y,CL1], [H1X,H1Y,HL1], PLAYER, AlphaBetaDepth],Val):-
     manhattan_distance([C1X,C1Y],[H1X,H1Y],Distance),
     bad_val(BadVal),
     abs(C1X - H1X,R1),abs(C1Y - H1Y,R2),
     (
        Val is 10, (R1 is 50, R2 is 50)
        ;
        Val is BadVal,  ((R1 is 100 , R2 is 100) ; (R1 is 50 , R2 is 100); (R1 is 100 , R2 is 50))
        ;
        Val is -Distance
     ).


manhattan_distance([X1,Y1],[X2,Y2],RES):-
    X is X1 - X2,
    Y is Y1 - Y2,
   abs(X,PX),abs(Y,PY),
    RES is PX + PY.


/*-------------------  evaluation function  --------------------*/






